@model  List<QuestionModel>
@{
    ViewBag.Title = "DoTest";
    Layout = "~/Views/Shared/_LayoutQuiz.cshtml";
}

@{
    var barWidth = 100 / Model.Count;
}
<style>
    .step-bar .bar{
        width: @(barWidth)% !important;
    }
</style>
<!-- step-number -->
<div class="step-number">
    <div class="step-number-inner">
        Question <span id="activeStep">1</span>/@Model.Count
    </div>
</div>


<div class="container">
    <div class="row">
        <div class="tab-100 order-c col-md-5 p-relative">
            <!-- side image -->
            <div class="side-img">
                <img src="~/Content/assets/images/side.png" alt="side-img">
            </div>

            <!-- bar -->
            <div class="step-bar">
                @{ var idx = 1;}
                @foreach (var q in Model)
                {
                    var load = idx == 1 ? "w-100 fill" : "fill";
                    <div class="bar">
                        <div class="@load"></div>
                    </div>
                    idx++;
                }
            </div>
        </div>

        <div class="tab-100 col-md-7">
            <div class="show-section wrapper">
                @{ var idx1 = 1;}
                @foreach (var q in Model)
                {
                    <section class="steps">
                        <!-- form -->
                        <form id="step@(idx1)" method="post" novalidate>
                            <!-- heading -->
                            <h2 class="q-heading">
                                @q.Description
                            </h2>

                            <!-- form field -->
                            <div class="form-inner">
                                @foreach (var answer in q.Answers)
                                {
                                    <div class="bounce-left radio-field">
                                        <input class="checkmark" type="radio" name="@q.Id" value="@answer.Value">
                                        <label>@answer.Label</label>
                                    </div>
                                }
                            </div>
                            <!-- next previous button -->
                            @if (idx1 == Model.Count)
                            {
                                <div class="next-prev">
                                    <button type="button" class="prev">
                                        <i class="fa-solid fa-arrow-left"></i>last question
                                    </button>
                                    <button type="button" class="apply" id="sub">
                                        Submit<i class="fa-solid fa-arrow-right"></i>
                                    </button>
                                </div>
                            }
                            else
                            {
                                <div class="next-prev">
                                    <button type="button" class="prev">
                                        <i class="fa-solid fa-arrow-left"></i>last question
                                    </button>
                                    <button type="button" data-id="@(idx1)" class="next" id="step@(idx1)btn">
                                        next question<i class="fa-solid fa-arrow-right"></i>
                                    </button>
                                </div>
                            }

                           
                        </form>
                    </section>
                    idx1++;
                }

            </div>
        </div>
    </div>
</div>

<!-- result -->
<div class="loadingresult">
    <img src="~/Content/assets/images/loading.gif" alt="loading">
</div>

<div class="result_page">
    <div class="result_inner">
        <div class="result_inner2">
            <h2>Knowledge Check</h2>
            <div class="u_result">
                <div class="u_score">Your Score: </div>
                <div class="u_prcnt">
                    20%
                </div>
                <span>20 Points</span>
            </div>
            <div class="p_result">
                <div class="p_score">Passing Score: </div>
                <div class="p_prcnt">
                    80%
                </div>
                <span>80 Points</span>
            </div>
            <div class="line"></div>
            <div class="result_show">
                <h2>Result</h2>
                <div class="pass_check">
                    <i class="fa-solid fa-xmark"></i>You did not Pass
                </div>
                <div class="result_msg">
                    Better Luck Next Time!
                </div>
            </div>
        </div>

        <!-- rectangle -->
        <img class="behind_bg" src="~/Content/assets/images/bh-clip.png" alt="rectangle">
    </div>
</div>

@section scripts {
    @*<script src="~/Content/assets/js/custom.js"></script>*@
<script>
        // next prev
        var divs = $('.show-section section');
        var now = 0; // currently shown div
        divs.hide().first().show(); // hide all divs except first

        function next() {
            divs.eq(now).hide();
            now = (now + 1 < divs.length) ? now + 1 : 0;
            divs.eq(now).show(); // show next
            console.log(now);

            showActiveStep(now);
        }
        //show active step
        function showActiveStep(now) {
            var _now = now + 1;
            var stepId = "#step" + _now;
            if ($(stepId).is(':visible')) {
                $(".step-bar .bar .fill").eq(now).addClass('w-100');
                $("#activeStep").html(_now);
            }
        }
        $(".prev").on('click', function () {

            $('.radio-field').addClass('bounce-left');
            $('.radio-field').removeClass('bounce-right');
            $(".step-bar .bar .fill").eq(now).removeClass('w-100');
            divs.eq(now).hide();
            now = (now > 0) ? now - 1 : divs.length - 1;
            divs.eq(now).show(); // show previous
            console.log(now);

            showActiveStep(now);
        })

        // quiz validation
        var checkedradio = false;
        function radiovalidate(stepnumber) {
            var checkradio = $("#step" + stepnumber + " input").map(function () {
                if ($(this).is(':checked')) {
                    return true;
                }
                else {
                    return false;
                }
            }).get();

            checkedradio = checkradio.some(Boolean);
        }

        // form validation
        $(document).ready(function () {
            @for (var i = 1; i < Model.Count-1; i++) {
                <text>
                $("#step" + @(i) + "btn").on('click', function () {
                    radiovalidate( @(i) );

                    if (checkedradio == false) {

                        (function (el) {
                            setTimeout(function () {
                                el.children().remove('.reveal');
                            }, 3000);
                        }($('#error').append('<div class="reveal alert alert-danger">Choose an option!</div>')));

                        radiovalidate(@(i));

                    }
                    else {
                        if ((now+1)==@(Model.Count)){
                            countresult(@(Model.Count));
                            showresult();
                            $("#sub").html('done');
                        }else {
                            $('#step' + @(i) + ' .radio-field').removeClass('bounce-left');
                            $('#step' + @(i) + ' .radio-field').addClass('bounce-right');
                            setTimeout(function () {
                                next();
                            }, 900)

                            countresult(@(i));
                        }
                    }
                })
                </text>
            }





            function showresult()
            {
                $('.loadingresult').css('display', 'grid');

                setTimeout(function()
                {
                    $('.result_page').addClass('result_page_show');

                },1000)
            };



            //correct answers
            var correct_answers = [3,2];

            // user answers
            let correct = 0;

            var steps = $('section').length;

            console.log(steps);

            function countresult(resultnumber)
            {
                $('#step'+resultnumber+' .radio-field input').each(function()
                {
                    for(var i = 0; i<=correct_answers.length; i++)
                    {
                        if($(this).is(':checked'))
                    {
                        if($(this).val() == correct_answers[i])
                        {


                            correct++;

                            break;

                        }
                    }
                    }

                })

                var correctprcnt = correct / steps * 100;

                $('.u_prcnt').html(correctprcnt + '%');
                $('.u_result span').html(correctprcnt + ' Points');

                if(correctprcnt >=80)
                {
                    $('.pass_check').html('<i class="fa-solid fa-check"></i> You Passed!');
                    $('.result_msg').html('You passed the test!');
                }
                }

        })

</script>

    @*<script src="~/Content/assets/js/result.js"></script>*@
}